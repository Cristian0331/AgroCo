<app-animated-background />

<header class="topbar" *ngIf="!isAuthRoute && (!isHomeRoute || auth.token())">
  <div class="container topbar-inner">
    <div class="topbar-info">
      <button *ngIf="auth.token()" class="back-button" type="button" (click)="goBack()" aria-label="Volver">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
        </svg>
      </button>
    </div>
    <div class="nav-container">
      <button *ngIf="auth.token()" class="menu-button" type="button" (click)="toggleMenu()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <path d="M4 7h16" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
          <path d="M4 12h16" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
          <path d="M4 17h16" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
        </svg>
        <span>Menú</span>
      </button>
    </div>
  </div>
</header>

<div class="nav-overlay" *ngIf="auth.token() && menuOpen" (click)="closeMenu()"></div>
<div class="nav-dropdown" *ngIf="auth.token() && menuOpen">
  <ng-container *ngIf="auth.user()?.is_admin; else regularMenu">
    <a class="nav-item" routerLink="/admin" routerLinkActive="active" (click)="closeMenu()">
      <span class="icon" aria-hidden="true">
        <svg viewBox="0 0 24 24" focusable="false">
          <path d="M4 7h16M4 12h16M4 17h16" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" />
        </svg>
      </span>
      <span>Panel admin</span>
    </a>
    <a class="nav-item" routerLink="/profile" routerLinkActive="active" (click)="closeMenu()">
      <span class="icon" aria-hidden="true">
        <svg viewBox="0 0 24 24" focusable="false">
          <circle cx="12" cy="8" r="3.2" stroke="currentColor" stroke-width="1.6" fill="none" />
          <path d="M6 20c0-3.3 2.7-6 6-6s6 2.7 6 6" stroke="currentColor" stroke-width="1.6" fill="none" stroke-linecap="round" />
        </svg>
      </span>
      <span>Perfil</span>
    </a>
    <a class="nav-item" *ngIf="auth.token()" (click)="logout(); closeMenu()">
      <span class="icon" aria-hidden="true">
        <svg viewBox="0 0 24 24" focusable="false">
          <path d="M4 6h7M4 18h7" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" />
          <path d="M10 12h10l-3-3M20 12l-3 3" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" />
        </svg>
      </span>
      <span>Salir</span>
    </a>
  </ng-container>
  <ng-template #regularMenu>
    <a class="nav-item" routerLink="/" routerLinkActive="active" [routerLinkActiveOptions]="{exact:true}" (click)="closeMenu()">
      <span class="icon" aria-hidden="true">
        <svg viewBox="0 0 24 24" focusable="false">
          <path d="M4 10.5 12 4l8 6.5V20a1 1 0 0 1-1 1h-5v-5H10v5H5a1 1 0 0 1-1-1z" stroke="currentColor" stroke-width="1.6" fill="none" stroke-linejoin="round" />
        </svg>
      </span>
      <span>Inicio</span>
    </a>
    <a class="nav-item" routerLink="/profile" routerLinkActive="active" (click)="closeMenu()">
      <span class="icon" aria-hidden="true">
        <svg viewBox="0 0 24 24" focusable="false">
          <circle cx="12" cy="8" r="3.2" stroke="currentColor" stroke-width="1.6" fill="none" />
          <path d="M6 20c0-3.3 2.7-6 6-6s6 2.7 6 6" stroke="currentColor" stroke-width="1.6" fill="none" stroke-linecap="round" />
        </svg>
      </span>
      <span>Perfil</span>
    </a>
    <a class="nav-item" *ngIf="auth.token()" (click)="logout(); closeMenu()">
      <span class="icon" aria-hidden="true">
        <svg viewBox="0 0 24 24" focusable="false">
          <path d="M4 6h7M4 18h7" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" />
          <path d="M10 12h10l-3-3M20 12l-3 3" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" />
        </svg>
      </span>
      <span>Salir</span>
    </a>
  </ng-template>
</div>

<main class="main" [class.container]="!isAuthRoute" [class.auth-route]="isAuthRoute">
  <router-outlet />
</main>

<app-chat-widget *ngIf="auth.token() && !isAdminRoute" />
<app-toast-container />
